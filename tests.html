<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR Code Generator - Test Suite</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: #f5f5f5;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 10px;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
        }

        .summary {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .summary-item {
            background: white;
            padding: 20px 40px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
        }

        .summary-value {
            font-size: 36px;
            font-weight: 700;
        }

        .summary-label {
            font-size: 14px;
            color: #666;
            text-transform: uppercase;
        }

        .passed .summary-value { color: #28a745; }
        .failed .summary-value { color: #dc3545; }
        .total .summary-value { color: #333; }

        .test-section {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            overflow: hidden;
        }

        .section-header {
            background: #667eea;
            color: white;
            padding: 15px 20px;
            font-weight: 600;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .section-header .badge {
            background: rgba(255,255,255,0.2);
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
        }

        .test-list {
            padding: 0;
        }

        .test-item {
            padding: 12px 20px;
            border-bottom: 1px solid #eee;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .test-item:last-child {
            border-bottom: none;
        }

        .test-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .test-icon.pass {
            background: #d4edda;
            color: #28a745;
        }

        .test-icon.fail {
            background: #f8d7da;
            color: #dc3545;
        }

        .test-name {
            flex: 1;
            font-size: 14px;
        }

        .test-details {
            font-size: 12px;
            color: #666;
            max-width: 400px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .test-time {
            font-size: 12px;
            color: #999;
            min-width: 60px;
            text-align: right;
        }

        .visual-tests {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            padding: 20px;
        }

        .visual-test {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
        }

        .visual-test h4 {
            margin-bottom: 10px;
            font-size: 14px;
        }

        .visual-test canvas {
            border: 2px solid #333;
            border-radius: 4px;
            background: white;
        }

        .visual-test .meta {
            margin-top: 10px;
            font-size: 12px;
            color: #666;
        }

        .manual-section {
            background: #fff3cd;
            border: 1px solid #ffc107;
            border-radius: 8px;
            padding: 20px;
            margin-top: 30px;
        }

        .manual-section h3 {
            color: #856404;
            margin-bottom: 15px;
        }

        .manual-section ul {
            margin-left: 20px;
            color: #856404;
        }

        .manual-section li {
            margin-bottom: 8px;
        }

        .controls {
            text-align: center;
            margin-bottom: 30px;
        }

        button {
            padding: 12px 24px;
            font-size: 16px;
            font-weight: 600;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            background: #667eea;
            color: white;
            margin: 0 10px;
        }

        button:hover {
            background: #5a6fd6;
        }

        .status-running {
            color: #856404;
            font-style: italic;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>QR Code Generator - Test Suite</h1>
        <p class="subtitle">ISO/IEC 18004:2024 Compliance Tests</p>

        <div class="controls">
            <button id="runTests">Run All Tests</button>
        </div>

        <div class="summary" id="summary">
            <div class="summary-item total">
                <div class="summary-value" id="totalCount">0</div>
                <div class="summary-label">Total Tests</div>
            </div>
            <div class="summary-item passed">
                <div class="summary-value" id="passedCount">0</div>
                <div class="summary-label">Passed</div>
            </div>
            <div class="summary-item failed">
                <div class="summary-value" id="failedCount">0</div>
                <div class="summary-label">Failed</div>
            </div>
        </div>

        <div id="testResults"></div>

        <div class="test-section" id="visualTests">
            <div class="section-header">
                <span>Visual Tests - Generated QR Codes</span>
                <span class="badge" id="visualBadge">0 codes</span>
            </div>
            <div class="visual-tests" id="visualTestContainer"></div>
        </div>

        <div class="manual-section">
            <h3>Manual Validation Instructions</h3>
            <ul>
                <li>Use a smartphone QR scanner app to scan each generated QR code above</li>
                <li>Verify that the decoded URL matches the expected value shown below each code</li>
                <li>Test scanning at different angles and distances to verify robustness</li>
                <li>Verify the QR code maintains readability after downloading as PNG</li>
                <li>Test with different error correction levels to observe the visual difference</li>
            </ul>
        </div>
    </div>

    <script src="qrcode.js"></script>
    <script>
    // ============================================================
    // TEST FRAMEWORK
    // ============================================================

    const TestRunner = (function() {
        'use strict';

        const results = [];
        const sections = {};

        function assert(condition, message) {
            if (!condition) {
                throw new Error(message || 'Assertion failed');
            }
        }

        function assertEqual(actual, expected, message) {
            if (actual !== expected) {
                throw new Error(`${message || 'Assertion failed'}: expected ${expected}, got ${actual}`);
            }
        }

        function assertArrayEqual(actual, expected, message) {
            if (actual.length !== expected.length) {
                throw new Error(`${message || 'Array length mismatch'}: expected ${expected.length}, got ${actual.length}`);
            }
            for (let i = 0; i < actual.length; i++) {
                if (actual[i] !== expected[i]) {
                    throw new Error(`${message || 'Array mismatch'} at index ${i}: expected ${expected[i]}, got ${actual[i]}`);
                }
            }
        }

        function test(name, section, fn) {
            const start = performance.now();
            let passed = true;
            let error = null;

            try {
                fn();
            } catch (e) {
                passed = false;
                error = e.message;
            }

            const end = performance.now();
            const result = {
                name,
                section,
                passed,
                error,
                time: end - start
            };

            results.push(result);

            if (!sections[section]) {
                sections[section] = [];
            }
            sections[section].push(result);

            return result;
        }

        function getResults() {
            return results;
        }

        function getSections() {
            return sections;
        }

        function getSummary() {
            const total = results.length;
            const passed = results.filter(r => r.passed).length;
            const failed = total - passed;
            return { total, passed, failed };
        }

        function clear() {
            results.length = 0;
            for (const key in sections) {
                delete sections[key];
            }
        }

        return {
            assert,
            assertEqual,
            assertArrayEqual,
            test,
            getResults,
            getSections,
            getSummary,
            clear
        };
    })();

    // ============================================================
    // TEST CASES
    // ============================================================

    function runAllTests() {
        TestRunner.clear();

        // MODE DETECTION TESTS
        TestRunner.test('Detect numeric mode for digits only', 'Mode Detection', () => {
            const mode = QRCode._internal.detectMode('0123456789');
            TestRunner.assertEqual(mode, 'NUMERIC');
        });

        TestRunner.test('Detect alphanumeric mode for uppercase letters', 'Mode Detection', () => {
            const mode = QRCode._internal.detectMode('HELLO WORLD');
            TestRunner.assertEqual(mode, 'ALPHANUMERIC');
        });

        TestRunner.test('Detect alphanumeric mode for mixed case with special chars', 'Mode Detection', () => {
            const mode = QRCode._internal.detectMode('HTTPS://EXAMPLE.COM');
            TestRunner.assertEqual(mode, 'ALPHANUMERIC');
        });

        TestRunner.test('Detect byte mode for lowercase letters', 'Mode Detection', () => {
            const mode = QRCode._internal.detectMode('https://example.com');
            TestRunner.assertEqual(mode, 'BYTE');
        });

        TestRunner.test('Detect byte mode for special characters', 'Mode Detection', () => {
            const mode = QRCode._internal.detectMode('hello@world.com');
            TestRunner.assertEqual(mode, 'BYTE');
        });

        // NUMERIC ENCODING TESTS
        TestRunner.test('Encode "01234567" as numeric (from ISO example)', 'Numeric Encoding', () => {
            const bits = QRCode._internal.encodeNumeric('01234567');
            TestRunner.assertEqual(bits.length, 27);
        });

        TestRunner.test('Encode single digit', 'Numeric Encoding', () => {
            const bits = QRCode._internal.encodeNumeric('7');
            TestRunner.assertEqual(bits.length, 4);
            TestRunner.assertArrayEqual(bits, [0, 1, 1, 1]);
        });

        TestRunner.test('Encode two digits', 'Numeric Encoding', () => {
            const bits = QRCode._internal.encodeNumeric('67');
            TestRunner.assertEqual(bits.length, 7);
        });

        TestRunner.test('Encode three digits', 'Numeric Encoding', () => {
            const bits = QRCode._internal.encodeNumeric('123');
            TestRunner.assertEqual(bits.length, 10);
        });

        // ALPHANUMERIC ENCODING TESTS
        TestRunner.test('Encode "AC-42" as alphanumeric (from ISO example)', 'Alphanumeric Encoding', () => {
            const bits = QRCode._internal.encodeAlphanumeric('AC-42');
            TestRunner.assertEqual(bits.length, 28);
        });

        TestRunner.test('Encode single alphanumeric character', 'Alphanumeric Encoding', () => {
            const bits = QRCode._internal.encodeAlphanumeric('A');
            TestRunner.assertEqual(bits.length, 6);
        });

        TestRunner.test('Encode pair of alphanumeric characters', 'Alphanumeric Encoding', () => {
            const bits = QRCode._internal.encodeAlphanumeric('AB');
            TestRunner.assertEqual(bits.length, 11);
        });

        // BYTE ENCODING TESTS
        TestRunner.test('Encode ASCII text as byte', 'Byte Encoding', () => {
            const bits = QRCode._internal.encodeByte('hello');
            TestRunner.assertEqual(bits.length, 40);
        });

        TestRunner.test('Encode UTF-8 text with multibyte characters', 'Byte Encoding', () => {
            const bits = QRCode._internal.encodeByte('hello');
            TestRunner.assertArrayEqual(bits.slice(0, 8), [0, 1, 1, 0, 1, 0, 0, 0]);
        });

        TestRunner.test('Encode URL with special characters', 'Byte Encoding', () => {
            const bits = QRCode._internal.encodeByte('https://example.com?q=test');
            TestRunner.assertEqual(bits.length, 26 * 8);
        });

        // ERROR CORRECTION TESTS
        TestRunner.test('Calculate ECC for simple data block', 'Error Correction', () => {
            const data = new Uint8Array([32, 91, 11, 120, 209, 114, 220, 77]);
            const ecc = QRCode._internal.calculateECC(data, 10);
            TestRunner.assertEqual(ecc.length, 10);
        });

        TestRunner.test('ECC generates correct number of codewords', 'Error Correction', () => {
            const data = new Uint8Array([64, 196, 132, 84, 196, 196, 242, 194, 4, 132, 20, 37, 34, 16, 236, 17]);
            const ecc = QRCode._internal.calculateECC(data, 10);
            TestRunner.assertEqual(ecc.length, 10);
        });

        TestRunner.test('ECC values are in valid range (0-255)', 'Error Correction', () => {
            const data = new Uint8Array([1, 2, 3, 4, 5, 6, 7, 8, 9, 10]);
            const ecc = QRCode._internal.calculateECC(data, 7);
            for (let i = 0; i < ecc.length; i++) {
                TestRunner.assert(ecc[i] >= 0 && ecc[i] <= 255, `ECC value ${ecc[i]} out of range`);
            }
        });

        // MASK PATTERN TESTS
        TestRunner.test('Mask pattern 0: (i + j) mod 2 = 0', 'Mask Patterns', () => {
            const pattern = QRCode._internal.MASK_PATTERNS[0];
            TestRunner.assertEqual(pattern(0, 0), true);
            TestRunner.assertEqual(pattern(0, 1), false);
            TestRunner.assertEqual(pattern(1, 1), true);
        });

        TestRunner.test('Mask pattern 1: i mod 2 = 0', 'Mask Patterns', () => {
            const pattern = QRCode._internal.MASK_PATTERNS[1];
            TestRunner.assertEqual(pattern(0, 0), true);
            TestRunner.assertEqual(pattern(1, 0), false);
            TestRunner.assertEqual(pattern(2, 5), true);
        });

        TestRunner.test('Mask pattern 2: j mod 3 = 0', 'Mask Patterns', () => {
            const pattern = QRCode._internal.MASK_PATTERNS[2];
            TestRunner.assertEqual(pattern(5, 0), true);
            TestRunner.assertEqual(pattern(5, 1), false);
            TestRunner.assertEqual(pattern(5, 3), true);
        });

        TestRunner.test('Mask pattern evaluation returns positive score', 'Mask Patterns', () => {
            const size = 21;
            const matrix = [];
            for (let i = 0; i < size; i++) {
                matrix[i] = [];
                for (let j = 0; j < size; j++) {
                    matrix[i][j] = (i + j) % 2;
                }
            }
            const score = QRCode._internal.evaluateMask(matrix, size);
            TestRunner.assert(score >= 0, 'Score should be non-negative');
        });

        // FORMAT INFO TESTS
        TestRunner.test('Format info lookup returns valid values', 'Format Information', () => {
            for (let i = 0; i < 32; i++) {
                const value = QRCode._internal.FORMAT_INFO[i];
                TestRunner.assert(value >= 0 && value <= 0x7FFF, `Format info ${i} out of range`);
            }
        });

        TestRunner.test('Format info for L-0 is correct (0x77C4)', 'Format Information', () => {
            const formatInfo = QRCode._internal.FORMAT_INFO[8];
            TestRunner.assertEqual(formatInfo, 0x77C4);
        });

        TestRunner.test('Format info for M-0 is correct (0x5412)', 'Format Information', () => {
            const formatInfo = QRCode._internal.FORMAT_INFO[0];
            TestRunner.assertEqual(formatInfo, 0x5412);
        });

        // VERSION INFO TESTS
        TestRunner.test('Version info exists only for versions 7+', 'Version Information', () => {
            for (let v = 1; v <= 6; v++) {
                TestRunner.assertEqual(QRCode._internal.VERSION_INFO[v], null);
            }
            for (let v = 7; v <= 40; v++) {
                TestRunner.assert(QRCode._internal.VERSION_INFO[v] !== null, `Version ${v} info missing`);
            }
        });

        TestRunner.test('Version 7 info is correct (0x07C94)', 'Version Information', () => {
            TestRunner.assertEqual(QRCode._internal.VERSION_INFO[7], 0x07C94);
        });

        TestRunner.test('Version 40 info is correct (0x28C69)', 'Version Information', () => {
            TestRunner.assertEqual(QRCode._internal.VERSION_INFO[40], 0x28C69);
        });

        // ALIGNMENT PATTERN TESTS
        TestRunner.test('Version 1 has no alignment patterns', 'Alignment Patterns', () => {
            TestRunner.assertEqual(QRCode._internal.ALIGNMENT_PATTERNS[1].length, 0);
        });

        TestRunner.test('Version 2 has alignment pattern at [6, 18]', 'Alignment Patterns', () => {
            TestRunner.assertArrayEqual(QRCode._internal.ALIGNMENT_PATTERNS[2], [6, 18]);
        });

        TestRunner.test('Version 7 has 3 alignment pattern coordinates', 'Alignment Patterns', () => {
            TestRunner.assertEqual(QRCode._internal.ALIGNMENT_PATTERNS[7].length, 3);
            TestRunner.assertArrayEqual(QRCode._internal.ALIGNMENT_PATTERNS[7], [6, 22, 38]);
        });

        // INTEGRATION TESTS
        TestRunner.test('Generate QR code for simple URL', 'Integration', () => {
            const qr = QRCode.generate('https://example.com', 'M');
            TestRunner.assert(qr.matrix !== null, 'Matrix should not be null');
            TestRunner.assert(qr.version >= 1 && qr.version <= 40, 'Version should be 1-40');
            TestRunner.assertEqual(qr.size, qr.version * 4 + 17);
        });

        TestRunner.test('Version 1 generates 21x21 matrix', 'Integration', () => {
            const qr = QRCode.generate('A', 'L');
            TestRunner.assertEqual(qr.version, 1);
            TestRunner.assertEqual(qr.size, 21);
            TestRunner.assertEqual(qr.matrix.length, 21);
            TestRunner.assertEqual(qr.matrix[0].length, 21);
        });

        TestRunner.test('Error correction level is preserved', 'Integration', () => {
            ['L', 'M', 'Q', 'H'].forEach(level => {
                const qr = QRCode.generate('TEST', level);
                TestRunner.assertEqual(qr.eccLevel, level);
            });
        });

        TestRunner.test('Mode is correctly detected and stored', 'Integration', () => {
            const numericQR = QRCode.generate('12345', 'M');
            TestRunner.assertEqual(numericQR.mode, 'NUMERIC');

            const alphaQR = QRCode.generate('HELLO', 'M');
            TestRunner.assertEqual(alphaQR.mode, 'ALPHANUMERIC');

            const byteQR = QRCode.generate('hello', 'M');
            TestRunner.assertEqual(byteQR.mode, 'BYTE');
        });

        TestRunner.test('Mask pattern is valid (0-7)', 'Integration', () => {
            const qr = QRCode.generate('https://example.com', 'M');
            TestRunner.assert(qr.maskPattern >= 0 && qr.maskPattern <= 7);
        });

        TestRunner.test('Matrix contains only 0 and 1 values', 'Integration', () => {
            const qr = QRCode.generate('https://example.com', 'M');
            for (let i = 0; i < qr.size; i++) {
                for (let j = 0; j < qr.size; j++) {
                    TestRunner.assert(qr.matrix[i][j] === 0 || qr.matrix[i][j] === 1,
                        `Invalid value at (${i}, ${j}): ${qr.matrix[i][j]}`);
                }
            }
        });

        TestRunner.test('Finder patterns are correctly placed', 'Integration', () => {
            const qr = QRCode.generate('TEST', 'M');
            const size = qr.size;

            TestRunner.assertEqual(qr.matrix[3][3], 1, 'Top-left finder center should be dark');
            TestRunner.assertEqual(qr.matrix[3][size - 4], 1, 'Top-right finder center should be dark');
            TestRunner.assertEqual(qr.matrix[size - 4][3], 1, 'Bottom-left finder center should be dark');
        });

        // EDGE CASE TESTS
        TestRunner.test('Empty input throws error', 'Edge Cases', () => {
            let threw = false;
            try {
                QRCode.generate('', 'M');
            } catch (e) {
                threw = true;
            }
            TestRunner.assert(threw, 'Should throw error for empty input');
        });

        TestRunner.test('Single character input works', 'Edge Cases', () => {
            const qr = QRCode.generate('A', 'L');
            TestRunner.assert(qr !== null);
        });

        TestRunner.test('Maximum capacity URL for version 1-L', 'Edge Cases', () => {
            const url = 'http://x.co/12345';
            const qr = QRCode.generate(url, 'L');
            TestRunner.assertEqual(qr.version, 1);
        });

        TestRunner.test('URL longer than version 1 capacity uses version 2+', 'Edge Cases', () => {
            const url = 'https://example.com/test';
            const qr = QRCode.generate(url, 'L');
            TestRunner.assert(qr.version >= 2);
        });

        TestRunner.test('Special URL characters are handled', 'Edge Cases', () => {
            const url = 'https://example.com/path?query=value&foo=bar#anchor';
            const qr = QRCode.generate(url, 'M');
            TestRunner.assert(qr !== null);
        });

        TestRunner.test('Unicode URL is handled', 'Edge Cases', () => {
            const url = 'https://example.com/path';
            const qr = QRCode.generate(url, 'M');
            TestRunner.assert(qr !== null);
        });

        TestRunner.test('Very long URL uses higher version', 'Edge Cases', () => {
            const url = 'https://example.com/' + 'a'.repeat(230);
            const qr = QRCode.generate(url, 'L');
            TestRunner.assert(qr.version >= 10, `Expected version >= 10, got ${qr.version}`);
        });

        // VERSION SELECTION TESTS
        TestRunner.test('Correct version for different ECC levels', 'Version Selection', () => {
            const url = 'https://example.com';

            const qrL = QRCode.generate(url, 'L');
            const qrH = QRCode.generate(url, 'H');

            TestRunner.assert(qrH.version >= qrL.version);
        });

        TestRunner.test('Version selection matches capacity table', 'Version Selection', () => {
            const capacity = QRCode._internal.BYTE_CAPACITY[1][1];
            TestRunner.assertEqual(capacity, 14);

            const url = 'http://x.co/ab';
            const qr = QRCode.generate(url, 'M');
            TestRunner.assertEqual(qr.version, 1);
        });

        // RENDERING TESTS
        TestRunner.test('Render creates canvas with correct dimensions', 'Rendering', () => {
            const canvas = document.createElement('canvas');
            const qr = QRCode.generate('TEST', 'M');
            const moduleSize = 8;
            const quietZone = 4;

            QRCode.render(canvas, qr, moduleSize);

            const expectedSize = (qr.size + quietZone * 2) * moduleSize;
            TestRunner.assertEqual(canvas.width, expectedSize);
            TestRunner.assertEqual(canvas.height, expectedSize);
        });

        TestRunner.test('Render with different module sizes', 'Rendering', () => {
            [4, 6, 8, 10, 12].forEach(moduleSize => {
                const canvas = document.createElement('canvas');
                const qr = QRCode.generate('TEST', 'M');

                QRCode.render(canvas, qr, moduleSize);

                const quietZone = 4;
                const expectedSize = (qr.size + quietZone * 2) * moduleSize;
                TestRunner.assertEqual(canvas.width, expectedSize);
            });
        });
    }

    // ============================================================
    // UI RENDERING
    // ============================================================

    function renderResults() {
        const summary = TestRunner.getSummary();
        document.getElementById('totalCount').textContent = summary.total;
        document.getElementById('passedCount').textContent = summary.passed;
        document.getElementById('failedCount').textContent = summary.failed;

        const sections = TestRunner.getSections();
        const container = document.getElementById('testResults');
        container.innerHTML = '';

        for (const [sectionName, tests] of Object.entries(sections)) {
            const passed = tests.filter(t => t.passed).length;
            const total = tests.length;

            const section = document.createElement('div');
            section.className = 'test-section';
            section.innerHTML = `
                <div class="section-header">
                    <span>${sectionName}</span>
                    <span class="badge">${passed}/${total} passed</span>
                </div>
                <div class="test-list">
                    ${tests.map(test => `
                        <div class="test-item">
                            <div class="test-icon ${test.passed ? 'pass' : 'fail'}">
                                ${test.passed ? '&#10003;' : '&#10007;'}
                            </div>
                            <div class="test-name">${test.name}</div>
                            <div class="test-details">${test.error || ''}</div>
                            <div class="test-time">${test.time.toFixed(2)}ms</div>
                        </div>
                    `).join('')}
                </div>
            `;
            container.appendChild(section);
        }
    }

    function renderVisualTests() {
        const container = document.getElementById('visualTestContainer');
        container.innerHTML = '';

        const testCases = [
            { url: 'https://example.com', ecc: 'L', label: 'Simple URL (ECC-L)' },
            { url: 'https://example.com', ecc: 'M', label: 'Simple URL (ECC-M)' },
            { url: 'https://example.com', ecc: 'Q', label: 'Simple URL (ECC-Q)' },
            { url: 'https://example.com', ecc: 'H', label: 'Simple URL (ECC-H)' },
            { url: 'https://github.com/user/repo', ecc: 'M', label: 'GitHub URL' },
            { url: 'https://example.com/path?query=value&foo=bar', ecc: 'M', label: 'URL with Query Params' },
            { url: '12345', ecc: 'M', label: 'Numeric Only' },
            { url: 'HELLO WORLD', ecc: 'M', label: 'Alphanumeric Only' }
        ];

        testCases.forEach(testCase => {
            try {
                const qr = QRCode.generate(testCase.url, testCase.ecc);

                const div = document.createElement('div');
                div.className = 'visual-test';

                const canvas = document.createElement('canvas');
                QRCode.render(canvas, qr, 4);

                div.innerHTML = `<h4>${testCase.label}</h4>`;
                div.appendChild(canvas);
                div.innerHTML += `
                    <div class="meta">
                        Version ${qr.version} | ${qr.size}x${qr.size} | Mask ${qr.maskPattern}<br>
                        <small>${testCase.url}</small>
                    </div>
                `;

                container.appendChild(div);
            } catch (e) {
                console.error(`Failed to generate QR for ${testCase.label}:`, e);
            }
        });

        document.getElementById('visualBadge').textContent = `${testCases.length} codes`;
    }

    // ============================================================
    // INITIALIZATION
    // ============================================================

    document.getElementById('runTests').addEventListener('click', () => {
        runAllTests();
        renderResults();
        renderVisualTests();
    });

    // Auto-run tests on load
    window.addEventListener('load', () => {
        runAllTests();
        renderResults();
        renderVisualTests();
    });
    </script>
</body>
</html>
